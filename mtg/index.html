<!DOCTYPE html>
<html lang="en">        
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>    
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">        
    </head>
    
    <body>
        
        <!-- Spinner -->
        <div id="loading" class="container-fluid h-100 justify-content-center">
            <div class="row justify-content-center align-middle h-100">
                <div class="d-flex justify-content-center align-self-center">
                    <div class="spinner-grow" role="status"></div>
                    <div class="spinner-grow" role="status"></div>
                    <div class="spinner-grow" role="status"></div>
                </div>
            </div>
        </div>
        
        <!-- Main -->
        <div id="main" class="pl-3 pr-3 d-none">
            <div class="row">
                <div class="col text-center p-1">
                    <p class="text-center m-1">Phase</p>
                    <div id="phases" class="btn-group-vertical btn-block"></div>
                </div>
                <div class="col text-center p-1">
                    <p class="text-center m-1">Step</p>
                    <div id="steps" class="btn-group-vertical btn-block"></div>
                </div>        
                <div class="col-7 text-center p-1">
                    <p class="text-center m-1">Action</p>
                    <div id="actions" class="btn-group-vertical btn-block"></div>
                </div>                
            </div>
            
            <div id="page" class="row justify-content-center text-center d-none">1/1</div>            
            
            <div class="row fixed-bottom p-2">                
                <div class="col text-center">
                    <button id="btn-previous" type="button" class="btn btn-secondary btn-lg">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    
                    <button id="btn-reset" type="button" class="btn btn-secondary btn-lg">
                        <i class="fas fa-redo"></i>
                    </button>
                    
                    <button id="btn-enter-fullscreen" type="button" class="btn btn-secondary btn-lg">
                        <i class="fas fa-expand"></i>
                    </button>
                    
                    <button id="btn-exit-fullscreen" type="button" class="btn btn-secondary btn-lg d-none">
                        <i class="fas fa-compress"></i>
                    </button>
                    
                    <button id="btn-next" type="button" class="btn btn-secondary btn-lg">
                        <i class="fas fa-arrow-right"></i>
                    </button>                    
                </div>
            </div>
        </div>
        
        <script>            
        var SHOW_NUMBERS = !true;
            
        $(function(){
            $("#localisations").load("localisations.html");
        });        
        
        $(document).ready(function() {            
            var indexPhase;
            var indexStep;
            var indexAction;
            
            var phaseSteps;
            var stepActions;            
            
            setTimeout(function() {
                $('#main').removeClass('d-none');
                $('#loading').addClass('d-none');
                
                reset();
                loadPhases();                
                updateCurrentPhase();
                updateCurrentStep();
                updateCurrentAction();
            }, 1000);            
            
            $('.priority').click(function(e) {
                $('.priority').toggleClass("btn-success");
                $('.priority').toggleClass("btn-danger");
                e.stopPropagation();
            });
            
            $('#main').click(function(e) {                
                //updateActionNext();
            });                        
            
            $('#btn-reset').click(function(e) {
                reset();
                e.stopPropagation();
            });
            
            $('#btn-enter-fullscreen').click(function() {                
                var main = $('#main').get(0);
                enterFullscreen(main);
                
                $("#btn-enter-fullscreen").toggleClass("d-none");
                $("#btn-exit-fullscreen").toggleClass("d-none");
                
                e.stopPropagation();
            });
            
            $('#btn-exit-fullscreen').click(function() {
                reset();
                var main = $('#main').get(0);
                exitFullscreen();
                
                $("#btn-enter-fullscreen").toggleClass("d-none");
                $("#btn-exit-fullscreen").toggleClass("d-none");
                
                e.stopPropagation();
            });
            
            $('#btn-previous').click(function(e) {
                updateActionPrevious();
                e.stopPropagation();
            });
                              
            $('#btn-next').click(function(e) {
                updateActionNext();
                e.stopPropagation();
            });
            
            $('body').on('click', '.btn-phase', function() {
                indexPhase = $(this).val();
                indexStep = 0;
                indexAction = 0;
                
                updateCurrentPhase();
                updateCurrentStep();
                updateCurrentAction();
            });
            
            $('body').on('click', '.btn-step', function() {
                indexStep = $(this).val();
                indexAction = 0;
                
                updateCurrentStep();
                updateCurrentAction();
            });
            
            $('body').on('click', '.btn-action', function() {                
                indexAction = $(this).val();
                
                updateCurrentAction();
            });
            
            function resetButtonsHightlight() {
                resetButtonsPhasesHightlight();
                resetButtonsStepsHightlight();
                resetButtonsActionsHightlight();
            }
            
            function updateCurrentPhase() {                
                resetButtonsHightlight();
                
                var button = $('#btn-phase-' + indexPhase);
                button.removeClass('btn-secondary');
                button.addClass('btn-primary');
                
                $('.btn-phase-' + indexPhase).each(function() {
                    $(this).removeClass("d-none");
                });
                
                updateAction();
                updateLabels();
            }            
            
            function resetButtonsPhasesHightlight() {
                $('.btn-phase').each(function() {
                    $(this).removeClass('btn-primary');
                    $(this).addClass('btn-secondary');
                });                
            }
            
            function updateCurrentStep() {                
                resetButtonsStepsHightlight();
                
                var button = $('#btn-phase-' + indexPhase + '-step-' + indexStep);
                button.removeClass('btn-secondary');
                button.addClass('btn-primary');      
                
                updateAction();
                updateLabels();
            }            
            
            function resetButtonsStepsHightlight() {
                $('.btn-step').each(function() {
                    $(this).addClass("d-none");
                    $(this).addClass("btn-secondary");
                });
                $('.btn-phase-' + indexPhase).each(function() {
                    $(this).removeClass("d-none");
                });
            }   
            
            function updateCurrentAction() {
                resetButtonsActionsHightlight();
                
                var button = $('#btn-phase-' + indexPhase + '-step-' + indexStep + '-action-' + indexAction);                
                button.removeClass('btn-secondary');
                button.addClass('btn-primary');      
                
                updateAction();
                updateLabels();
            }
            
            function resetButtonsActionsHightlight() {
                $('.btn-action').each(function() {
                    $(this).addClass("d-none");
                    $(this).addClass("btn-secondary");
                });                
                $('.btn-phase-' + indexPhase + '-step-' + indexStep).each(function() {
                    $(this).removeClass("d-none");
                });
            }
            
            function loadPhases() {
                var phases = data.phases[indexPhase];
                $.each(data.phases, function(localIndexPhase, phase) {    
                    var key = Object.keys(phase)[0];                    
                    
                    var button = $(document.createElement('button'));
                    $(button).prop("type", "button");
                    $(button).addClass("btn");
                    $(button).addClass("btn-block");
                    $(button).addClass("btn-secondary");
                    $(button).addClass("btn-phase");
                    $(button).prop("id", "btn-phase-" + localIndexPhase);     
                    $(button).html($('#' + key).html());
                    $(button).val(localIndexPhase);
                    $('#phases').append(button);
                    
                    $.each(phase[key], function(localIndexStep, step) {
                        key = Object.keys(step)[0];
                        
                        button = $(document.createElement('button'));
                        $(button).prop("type", "button");
                        $(button).addClass("btn");                        
                        $(button).addClass("btn-secondary");
                        $(button).addClass("btn-block");
                        $(button).addClass("btn-step");
                        $(button).addClass("btn-phase-" + localIndexPhase);
                        $(button).prop("id", 'btn-phase-' + localIndexPhase + '-step-' + localIndexStep);                        
                        $(button).html($('#' + key).html());
                        $(button).val(localIndexStep);
                        $('#steps').append(button);
                        
                        var stepActions = step[Object.keys(step)[0]];    
                        
                        for (var localIndexAction = 0; localIndexAction < stepActions.length; localIndexAction++) {
                            key = stepActions[localIndexAction];   
                            
                            button = $(document.createElement('button'));
                            $(button).prop("type", "button");
                            $(button).addClass("btn");                        
                            $(button).addClass("btn-secondary");  
                            $(button).addClass("btn-action");
                            $(button).addClass('btn-phase-' + localIndexPhase + '-step-' + localIndexStep);
                            $(button).prop("id", 'btn-phase-' + localIndexPhase + '-step-' + localIndexStep + '-action-' + localIndexAction);
                            $(button).html($('#' + key).html());
                            $(button).val(localIndexAction);
                            $('#actions').append(button);
                        }                        
                    });
                });                
            }            
            
            function enterFullscreen(element) {
                if(element.requestFullscreen)
                    element.requestFullscreen();
                else if(element.mozRequestFullScreen)
                    element.mozRequestFullScreen();
                else if(element.webkitRequestFullscreen)
                    element.webkitRequestFullscreen();
                else if(element.msRequestFullscreen)
                    element.msRequestFullscreen();
            }
            
            function exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
            
            function updateActionNext() {
                if (indexAction < stepActions.length - 1) {
                    indexAction++;
                } else {
                    indexAction = 0;
                    if (indexStep < phaseSteps.length - 1) {
                        indexStep++;
                    } else {
                        indexStep = 0;
                        if (indexPhase < data.phases.length - 1) {
                            indexPhase++;
                        } else {
                            indexPhase = 0;                            
                        }
                    }
                }
                
                updateCurrentPhase();
                updateCurrentStep();
                updateCurrentAction();
                updateAction();
                updateLabels();
            }
            
            function updateActionPrevious() {
                if (indexAction > 0) {
                    indexAction--;
                } else {
                    if (indexStep > 0) {
                        indexStep--;
                    } else {
                        if (indexPhase > 0) {
                            indexPhase--;    
                        } else {                            
                            indexPhase = data.phases.length - 1;      
                        }
                        updateAction();
                        indexStep = phaseSteps.length - 1;
                    }                    
                    updateAction();
                    indexAction = stepActions.length - 1;
                }                
                
                updateCurrentPhase();
                updateCurrentStep();
                updateCurrentAction();
                updateAction();
                updateLabels();
            }
            
            function reset() {
                indexAction = 0;
                indexStep = 0;
                indexPhase = 0;
                
                updateCurrentPhase();
                updateCurrentStep();
                updateCurrentAction();
                updateAction();
                updateLabels();
            }
            
            function updateLabels() {                
                var key = Object.keys(data.phases[indexPhase])[0];
                var text = $("#" + key).text();
                if (SHOW_NUMBERS) {
                    text = (indexPhase + 1) + ") " + text;
                }
                $("#phase").text(text);
                
                var key = Object.keys(phaseSteps[indexStep])[0];
                text = $("#" + key).text();
                if (SHOW_NUMBERS) {
                    text = (indexPhase + 1) + "." + (indexStep + 1) + ") " + text;
                }
                $("#step").text(text);                
                
                text = $("#" + stepActions[indexAction]).text();
                if (SHOW_NUMBERS) {
                    text = (indexPhase + 1) + "." + (indexStep + 1) + "." + (indexAction + 1) + ") " + text;
                }
                //$("#action").text(text);
                
                $("#page").text((indexAction + 1) + " / " + stepActions.length);                
            }                     
            
            function updateAction() {
                var phase = data.phases[indexPhase];                
                
                var key = Object.keys(phase)[0];
                phaseSteps = phase[key];
                //console.debug('phase=' + key);
                
                var step = phaseSteps[indexStep];                
                key = Object.keys(step)[0]; 
                stepActions = step[key];
                //console.debug('step=' + key);
                
                var action = stepActions[indexAction];
                //console.debug('action=' + action);
            }          
            
        });
            
        const data = {
            "phases":[
                {
                    "phase-beginning":[
                        {
                            "step-untap":[
                                "action-phasing",
                                "action-untap",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-upkeep":[
                                "action-upkeep",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-draw":[
                                "action-draw",
                                "action-draw-abilities",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        }
                    ]
                },
                {
                    "phase-main-1":[
                        {
                            "step-main":[
                                "action-main-abilities",
                                "action-main",
                                "action-empty-mana"
                            ]
                        }                        
                    ]
                },
                {
                    "phase-combat":[
                        {
                            "step-combat-begin":[
                                "action-combat-abilities",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-attackers":[
                                "action-attackers",
                                "action-attackers-abilities",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-blockers":[
                                "action-blockers",
                                "action-blockers-abilities",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-combat-damage":[
                                "action-attackers-damage-assign",
                                "action-attackers-damage-player",
                                "action-blockers-damage-assign",
                                "action-damage-resolution",
                                "action-damage-ability",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-combat-end":[
                                "action-combat-end",                                
                                "action-instants",
                                "action-combat-remove",
                                "action-combat-until",
                                "action-empty-mana"
                            ]
                        }                        
                    ]
                },
                {
                    "phase-main-2":[
                        {
                            "step-main":[
                                "action-main-abilities",
                                "action-main",
                                "action-empty-mana"
                            ]
                        }                        
                    ]
                },
                {
                    "phase-end":[
                        {
                            "step-end":[
                                "action-combat-abilities",
                                "action-instants",
                                "action-empty-mana"
                            ]
                        },
                        {
                            "step-cleanup":[
                                "action-discard",
                                "action-remove-damage",
                                "action-end-abilitites",
                                "action-empty-mana",
                                "action-instants",
                                "action-empty-mana",
                                "action-repeat-cleanup"
                            ]
                        }
                    ]
                }
            ]
        };        
        </script>
        
        <div id="localisations" class="d-none" />
        
    </body>
    
</html>